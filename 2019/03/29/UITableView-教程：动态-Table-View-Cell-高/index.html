<!DOCTYPE html>
<html lang=zh>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="旧翻译文章迁移自：简书 create by 2016.03.11 00:33 原文地址: RAYWENDERLICH  说明：英文水平有限，主要是为了巩固学到的知识，也能帮别人快速上手，节约时间，有任何破绽，尤其是技术上的，请您一定要告诉我。  （旁白:其实这张图几乎说明了所有问题，设置好constraints，其它都不是问题。补充一下：这篇教程实际上就是 auto layout教程。） 你应该在">
<meta name="keywords" content="Java, iOS, Web">
<meta property="og:type" content="article">
<meta property="og:title" content="UITableView 教程：动态 Table View Cell 高">
<meta property="og:url" content="https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/index.html">
<meta property="og:site_name" content="刘海川的技术博客">
<meta property="og:description" content="旧翻译文章迁移自：简书 create by 2016.03.11 00:33 原文地址: RAYWENDERLICH  说明：英文水平有限，主要是为了巩固学到的知识，也能帮别人快速上手，节约时间，有任何破绽，尤其是技术上的，请您一定要告诉我。  （旁白:其实这张图几乎说明了所有问题，设置好constraints，其它都不是问题。补充一下：这篇教程实际上就是 auto layout教程。） 你应该在">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-b4c2a9c6503a1bf7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-1a5f63380e4fc6b1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-a4e1b561eae1dbb1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-c6d192ff90daa617.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-f7351958cc1e759c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-dbbc08d28fc508d3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-9b5e34b14aa1529d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-86062ac8da1220d0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-da98165b24f829d0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-ddb2abb387bf0484.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-6395ce4516b7d966.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-02692ca37058d8ed.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-6a7ea558a5595a88.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-cbee2e78ebc6f56a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-d6245aeff9e3efa9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-d32e34c882d10d62.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-b87c60050207180e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-2e9f1ae063dd3eff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-04c1675cd8bc7c28.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-59740ab79e37f7e6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-93a32c53b29bfa42.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-d7702d171e6a9f76.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-2765e10b7f1cc464.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-fc841c3a50ffae77.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-866636a6c8206be1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-c73f8d6e70fc375d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-cb0cea31f71f636d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-b4c2a9c6503a1bf7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-d8bb318f8ad78ca6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/292794-5e6697a0e6d888be.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2019-03-29T15:36:17.116Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="UITableView 教程：动态 Table View Cell 高">
<meta name="twitter:description" content="旧翻译文章迁移自：简书 create by 2016.03.11 00:33 原文地址: RAYWENDERLICH  说明：英文水平有限，主要是为了巩固学到的知识，也能帮别人快速上手，节约时间，有任何破绽，尤其是技术上的，请您一定要告诉我。  （旁白:其实这张图几乎说明了所有问题，设置好constraints，其它都不是问题。补充一下：这篇教程实际上就是 auto layout教程。） 你应该在">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/292794-b4c2a9c6503a1bf7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>UITableView 教程：动态 Table View Cell 高</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="https://github.com/al-liu">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="https://github.com/al-liu?tab=repositories">项目</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2019/03/31/NSOperation-和-NSOperationQueue-的-Swift-教程/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2019/03/28/实现-iOS-类似-SpringBoard-图标合并删除排序功能/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/&text=UITableView 教程：动态 Table View Cell 高"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/&title=UITableView 教程：动态 Table View Cell 高"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/&is_video=false&description=UITableView 教程：动态 Table View Cell 高"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=UITableView 教程：动态 Table View Cell 高&body=Check out this article: https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/&title=UITableView 教程：动态 Table View Cell 高"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/&title=UITableView 教程：动态 Table View Cell 高"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/&title=UITableView 教程：动态 Table View Cell 高"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/&title=UITableView 教程：动态 Table View Cell 高"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/&name=UITableView 教程：动态 Table View Cell 高&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#让我们开始"><span class="toc-number">1.</span> <span class="toc-text">让我们开始</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#教程-App-概览"><span class="toc-number">2.</span> <span class="toc-text">教程 App 概览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开始创建自定义-Cell"><span class="toc-number">3.</span> <span class="toc-text">开始创建自定义 Cell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置-Table-View"><span class="toc-number">4.</span> <span class="toc-text">配置 Table View</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实现-UITableView-的-Data-Source"><span class="toc-number">5.</span> <span class="toc-text">实现 UITableView 的 Data Source</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#图片在哪呢？"><span class="toc-number">6.</span> <span class="toc-text">图片在哪呢？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#显示这些图片！"><span class="toc-number">7.</span> <span class="toc-text">显示这些图片！</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#优化表格"><span class="toc-number">8.</span> <span class="toc-text">优化表格</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#从这去哪呢"><span class="toc-number">9.</span> <span class="toc-text">从这去哪呢</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        UITableView 教程：动态 Table View Cell 高
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">刘海川的技术博客</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-03-29T15:22:15.000Z" itemprop="datePublished">2019-03-29</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>旧翻译文章迁移自：<a href="https://www.jianshu.com/u/06062b2fb381" target="_blank" rel="noopener">简书</a> create by 2016.03.11 00:33</p>
<p>原文地址: <a href="https://www.raywenderlich.com/87975/dynamic-table-view-cell-height-ios-8-swift" target="_blank" rel="noopener">RAYWENDERLICH
</a></p>
<p><strong>说明</strong>：英文水平有限，主要是为了巩固学到的知识，也能帮别人快速上手，节约时间，有任何破绽，尤其是技术上的，请您一定要告诉我。</p>
<hr>
<p><img src="http://upload-images.jianshu.io/upload_images/292794-b4c2a9c6503a1bf7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="学习怎样在iOS8上使用Swift创建动态Cell高"><br>（<em>旁白:其实这张图几乎说明了所有问题，设置好<code>constraints</code>，其它都不是问题。</em>补充一下：这篇教程实际上就是 auto layout教程。）</p>
<p>你应该在使用 table view cells 的时候经常会写很多代码，来手动计算label，image view，text field 和 cell 相关的每一个控件的高。<br>坦白讲，这种方法很容易出错且容易让人迷糊看不懂。<br>在这篇教程里，你将学会怎样创建自定义 cell 并且根据内容动态调整 cell 的高度，你可能会想，”这得需要多少工作量…!”<br>Nope! <em> （旁白：you are right ~</em>）<br>你很幸运，Apple 可以让你在 iOS8 里很容易的做到这些。你将从写适配代码中解脱出来。但是还是要实现 table view 的数据源和代理方法。</p>
<h2 id="让我们开始"><a href="#让我们开始" class="headerlink" title="让我们开始"></a>让我们开始</h2><p>iOS6出来几天之后，Apple 介绍了一个超赞的技术：auto layout。程序猿们开始庆祝，街头聚会，写赞歌…（<em>旁白：要不要这么夸张啊</em>）</p>
<p>好吧，也许有些问题，但它毕竟是一次大飞跃（<em>旁白：是这个意思吧，哈哈</em>）</p>
<p>在给了很多开发者希望的同时，auto layout 还是很难用的。尤其是手写 auto layout 代码。Interface Builder 在设置 constraints 时也并不理想。</p>
<p>很快到现在，伴随着对 Interface Builder 的所有改进和 iOS8 的到来，我们现在可以很容易的动态设置 table view cells 的高度了。</p>
<p>你需要不得不做的事情有：<br>1，在创建 table view cells 时使用 auto layout。<br>2，设置 table view 的<strong>rowHeight</strong>等于<strong>UITableViewAutomaticDimension</strong>。<br>3，设置<strong>estimatedRowHeight</strong>的值或者实现预估高度的代理方法。</p>
<p>这是你需要知道的几个要点，现在开始下载代码，搞起项目了。<br>（<em>旁白：确实很重要，虽然说了不少废话，但是并不是浪费时间的。</em>）</p>
<h2 id="教程-App-概览"><a href="#教程-App-概览" class="headerlink" title="教程 App 概览"></a>教程 App 概览</h2><p>设想一下你的老大来到你面前，对你说：“我们的用户在为看<strong>Deviant Artists</strong>的方法而大声抗议”。<br>我会问：”什么是<strong>Deviant Artists</strong>“。<br>你的头解释说：“那是一个艺术家们用来分享自己作品的社交平台。你可以通过<a href="http://www.deviantart.com" target="_blank" rel="noopener"> Deviant Art website</a> 和 <a href="https://www.deviantart.com/developers/rss" target="_blank" rel="noopener">Media RSS endpoint</a> 来了解艺术家的公告和动态。”<br>老大：“我们开始做这个 App 吧，但是要怎么样把内容显示到表格上呢？你能做到吧？”<br>你突然受到了感召，走进最近的电话亭，换上了披风成了super Dev..<br><img src="http://upload-images.jianshu.io/upload_images/292794-1a5f63380e4fc6b1.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>但你不需要弄骗人的把戏做你老大的英雄，用你的编程技术就可以做到了。<br>（<em>旁白：你怎么不去做导演啊…</em>）<br>首先，现在客户端代码（项目的起始程序）<a href="http://www.raywenderlich.com/wp-content/uploads/2015/01/DeviantArtBrowser_Starter.zip" target="_blank" rel="noopener">这里</a>。<br>（<em>旁白</em>：语法有一些过时，打开项目会自动让你转换到最新的语法，转换完之后会报一个错，将<strong>FeedViewController.swift</strong>里的**deselectAllRows 方法替换成如下代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">func deselectAllRows() &#123;</span><br><span class="line">    if let selectedRows = tableView.indexPathsForSelectedRows&#123;</span><br><span class="line">      for indexPath in selectedRows &#123;</span><br><span class="line">        tableView.deselectRowAtIndexPath(indexPath, animated: false)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>）<br>这个项目使用的<strong>CocoaPods</strong>，因此打开<strong>DeviantArtBrowser.xcworkspace</strong>（不是<strong>xcodeproj</strong>这个文件），pods 已经包含到 zip 包里了，所以不用在重新<strong>pod install</strong>。<br><strong>注意</strong>：如果你不清楚什么是 CocoaPods ，可以看下这个<a href="https://www.raywenderlich.com/64546/introduction-to-cocoapods-2" target="_blank" rel="noopener">教程</a>。</p>
<p>打开<strong>Main.storyboard</strong>（在<strong>DeviantArtBrowser</strong>project 下的<strong>DeviantArtBrowser</strong>文件夹<strong>Views</strong>分组里），你将会看到下面四个场景：<br><img src="http://upload-images.jianshu.io/upload_images/292794-a4e1b561eae1dbb1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>从左到右，它们是：</p>
<ul>
<li>顶级的导航控制器。<br><strong>*FeedViewController</strong>,标题是<strong>Deviant Browser</strong>。</li>
<li>还有两个都是<strong>DetailViewController</strong>的场景，标题分别是<strong>Deviant Article</strong>和<strong>Deviant Media</strong>，一个只用来显示文本，另一个文本和图片一起显示。<br>编译并运行，你将看到一些控制台上的输出日志和一个短暂出现的活动指示器，但是在 app 里并没有什么内容显示出来。<br>日志输出像下面一样：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2014-11-08 14:30:02.746 DeviantArtBrowser[70847:829282] GET &apos;http://backend.deviantart.com/rss.xml?q=boost%3Apopular&apos;</span><br><span class="line"></span><br><span class="line">2014-11-08 14:30:03.297 DeviantArtBrowser[70847:829282] 200 &apos;http://backend.deviantart.com/rss.xml?q=boost%3Apopular&apos; [0.5506 s]</span><br></pre></td></tr></table></figure>
<p>app 发起一个网络请求并获得返回，但是并没有做任何事。<br>（<em>旁白：如果请求失败，很可能是iOS9系统下不可用http协议，打开info.plist的源码，粘贴如下内容。</em>）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;</span><br><span class="line">    &lt;dict&gt;</span><br><span class="line">        &lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;</span><br><span class="line">        &lt;true/&gt;</span><br><span class="line">    &lt;/dict&gt;</span><br></pre></td></tr></table></figure>
<p>现在，打开<strong>FeedViewController.swift</strong>（在<strong>Controllers</strong>文件夹的下面）。<br>看下<strong>parseForQuery</strong>这段代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">func parseForQuery(query: String?) &#123;</span><br><span class="line">  showProgressHUD()</span><br><span class="line"> </span><br><span class="line">  parser.parseRSSFeed(deviantArtBaseUrlString,</span><br><span class="line">    parameters: parametersForQuery(query),</span><br><span class="line">    success: &#123;(let channel: RSSChannel!) -&gt; Void  in</span><br><span class="line"> </span><br><span class="line">      self.convertItemPropertiesToPlainText(channel.items as! [RSSItem])</span><br><span class="line">      self.items = (channel.items as! [RSSItem])</span><br><span class="line"> </span><br><span class="line">      self.hideProgressHUD()</span><br><span class="line">      self.reloadTableViewContent()</span><br><span class="line"> </span><br><span class="line">    &#125;, failure: &#123;(let error:NSError!) -&gt; Void in</span><br><span class="line"> </span><br><span class="line">      self.hideProgressHUD()</span><br><span class="line">      println(&quot;Error: \(error)&quot;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>parser</strong>是一个<strong>RSSParser</strong>的实例，属于 <a href="https://github.com/JRG-Developer/MediaRSSParser">MediaRSSParser</a> 的一部分。<br>这是一个得到<strong>Deviant Art</strong>RSS feed 的网络请求，它会在成功的 block 里返回一个<strong>RSSChannel</strong>实例。然后解析数据将 HTML 转成普通文本，<strong>channel.items</strong>和控制器里的<strong>items</strong>属性都是数组。</p>
<p><strong>channel.items</strong>数组包含<strong>RSSItem</strong>对象，每一个对象元素都是一个 RSS feed。（现在你该知道要将什么显示到表格里了吧，正是<strong>items</strong>数组!）</p>
<p>最后，项目里会有一些<strong>//TODO:Write this…</strong>的注释，是为了告诉我们需要实现些什么。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/292794-c6d192ff90daa617.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h2 id="开始创建自定义-Cell"><a href="#开始创建自定义-Cell" class="headerlink" title="开始创建自定义 Cell"></a>开始创建自定义 Cell</h2><p>查看源代码之后，你现在知道这个 app 有了不错的数据，但是什么都没有显示出来，要显示它们，你需要创建一个自定义的 table view cell。</p>
<ul>
<li>添加一个新类到<strong>DeviantArtBrowser</strong>项目里。</li>
<li>名字是<strong>BasicCell</strong>并且继承自<strong>UITableViewCell</strong>。</li>
<li>确信<strong>Also create xib file</strong>没有被勾选。</li>
<li>语言选择<strong>Swift</strong>。<br>打开<strong>BasicCell.swift</strong>并添加如下属性：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@IBOutlet var titleLabel: UILabel!</span><br><span class="line">@IBOutlet var subtitleLabel: UILabel!</span><br></pre></td></tr></table></figure>
<p>接下来，打开<strong>Main.storyboard</strong>，拖拽一个<strong>UITableViewCell到</strong>FeedViewController<strong>的 table view上。<br>设置 </strong>BasicCell<strong> 的 </strong>Custom Class<strong>。<br><img src="http://upload-images.jianshu.io/upload_images/292794-f7351958cc1e759c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>设置 </strong>BasicCell<strong> 的 </strong>Identifier(Reuse Identifier)<strong>。<br><img src="http://upload-images.jianshu.io/upload_images/292794-dbbc08d28fc508d3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>设置 cell 的</strong>Row Height<strong>为</strong>83<strong>。<br><img src="http://upload-images.jianshu.io/upload_images/292794-9b5e34b14aa1529d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>拖拽一个 UILabel 到 cell 上，设置 text为</strong>Title<strong>。<br><img src="http://upload-images.jianshu.io/upload_images/292794-86062ac8da1220d0.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>设置 label 的</strong>Lines<strong>为 0，就是没有上限。（行数可以设置很多）<br><img src="http://upload-images.jianshu.io/upload_images/292794-da98165b24f829d0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>接下来像下面截图一样设置 label 的尺寸和位置。<br><img src="http://upload-images.jianshu.io/upload_images/292794-ddb2abb387bf0484.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>连接 cell 的 label 到</strong>BasicCell<strong>的</strong>titleLabel<strong>outlet 上。<br><img src="http://upload-images.jianshu.io/upload_images/292794-6395ce4516b7d966.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>接下来，拖拽第二个 UILabel 到 cell 上，像第一个 label 一样，并且设置 text 为</strong>Subtitle<strong>。<br><img src="http://upload-images.jianshu.io/upload_images/292794-02692ca37058d8ed.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>像第一个 label 一样，按照下面的截图来设置 Subtitle 的尺寸和位置。<br><img src="http://upload-images.jianshu.io/upload_images/292794-6a7ea558a5595a88.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>设置 subtitle label 的</strong>Color<strong>为 <em> Light Gray Color </em>；字体大小为 <em> 15.0 </em>；并且</strong>Lines**为 0 ；<br><img src="http://upload-images.jianshu.io/upload_images/292794-cbee2e78ebc6f56a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>将 cell 的 subtitle label 连接到 BasicCell 上的 subtitleLabel outlet上。<br><img src="http://upload-images.jianshu.io/upload_images/292794-d6245aeff9e3efa9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>接下来，你将给<strong>BasicCell</strong>添加 auto layout<strong>constraints</strong>，来布局 cell 。<br><strong>注意</strong>:如果你对 auto layout 还不太熟悉，不清楚怎么设置 auto layout constraints ，可以看下 <a href="https://www.raywenderlich.com/115440/auto-layout-tutorial-in-ios-9-part-1-getting-started-2" target="_blank" rel="noopener">这个教程</a>。</p>
<p>选择 title label 且设置它的<strong>top</strong>，<strong>trailing</strong>，<strong>leading</strong>距离父视图（也就是content view）20个点。确信你没有勾选<strong>Constrain to margins</strong>。（<em>旁白</em>：这个属性就是系统会为你默认两边留白）<br><img src="http://upload-images.jianshu.io/upload_images/292794-d32e34c882d10d62.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片显示的很清楚"><br>确信 cell 的 title label 一直是：</p>
<ul>
<li>向上距离20个点。</li>
<li>相对于 content view 的整体宽度，左右两边空出20个点。</li>
</ul>
<p>现在，选择 subtitle label 设置它的<strong>leading</strong>，<strong>trailing</strong>，和<strong>bottom</strong>距离父视图20个点。再次确认，没有勾选<strong>Constrain to margins</strong>。<br><img src="http://upload-images.jianshu.io/upload_images/292794-b87c60050207180e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>像 title label 一样，确定在 subtitle label 上的<strong>constraints</strong>，是按照底部距离 content view 20个点，左右距离 content view 也是20个点。<br>（<em>旁白</em>：还是看图更直观一些）</p>
<p><strong>技巧</strong>: 使用 auto layout 布局<strong>UITableViewCell</strong>时，要确定这些约束都布局到了每一个 subview 的四边，也就是说，每一个 subview 都应该有 leading，top，trailing 和 bottom 约束。<br>除此之外，<strong>contentView</strong>的顶部到底部都要有清晰的约束条件， 你要能确定，这些子视图的约束可以正确的指定出<strong>contentView</strong>的高度。<br>另一部分技巧是，interface Builder 经常在你缺失一些约束的情况下，没有警告提示。在运行项目时，auto layout 没有返回正确的高度，比如会返回 0 的高度，遇到这些问题需要你重新调整约束条件 直到满足条件为止。</p>
<p>现在， 选择<strong>subtitle</strong>label, 按住<strong>Control</strong>并拖拽到 title label。选择<strong>Vertical Spacing</strong>连接<strong>subtitle label</strong>的顶部和<strong>title label</strong>的底部。</p>
<p>在 title label 上，设置<strong>Horizontal</strong>和<strong>Vertical</strong>的<strong>Content Hugging Priority</strong>和<strong>Content Compression Resistance Priority</strong>为<strong>751</strong>。<br><img src="http://upload-images.jianshu.io/upload_images/292794-2e9f1ae063dd3eff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>在 subtitle label 上，设置<strong>Horizontal</strong>和<strong>Vertical</strong>的<strong>Content Hugging Priority</strong>和<strong>Content Compression Resistance Priority</strong>为<strong>750</strong>。<br><img src="http://upload-images.jianshu.io/upload_images/292794-04c1675cd8bc7c28.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>（<em>旁白</em>：解释一下，这两个优先级的意思，<strong>Content Hugging Priority</strong>就是级别越高，越不会被拉开，抻开。<strong>Content Compression Resistance Priority</strong>就是级别越高，越不会被压缩，挤掉。这个还是要看具体的例子来理解的，有一点绕。）<br>这就是告诉 auto layout 怎样去适配 labels 的文本－区分 title label 和 subtitle label 之间约束的优先级。在这个例子里，这些约束基本满足了条件。</p>
<p><strong>检查</strong>: 上面的约束条件满足情况了吗？<br>1，每一个子视图的所有侧边都有约束吗？Yes。<br>2，<strong>contentView</strong>从上到下都有约束吗？Yes（<em>旁白</em>：只有这样 contentView 才能确定出自己的高度，像 UIScrollView 一样，才能知道自己的 contentSize，否则运行起来都不能滑动。）<br><strong>titleLabel</strong>距顶部有20个点，它和<strong>subtitleLabel</strong>之间的距离是4个点，并且<strong>subtitleLabel</strong>和底部有19.5个点。<br>所以，现在 auto layout 已经可以动态设置 cell 的高度了。</p>
<p>接下来，你要创建一个<strong>BasiceCell</strong>跳转到<strong>Deviant Article</strong>场景的链接(segue)。</p>
<p>选择你的<strong>BasiceCell</strong>，按住 control 拖拽到<strong>Deviant Article</strong>场景,从<strong>Selection Segue</strong>选项中选择<strong>Push</strong>。</p>
<p>Interface Builder 将自动更改<strong>Accessory</strong>属性为 <em>Disclosure Indicator</em>，这是为了指示你从 cell 导航到详情里去。然而，这并不符合程序的设计，选择<strong>BasiceCell</strong> ,更改<strong>Accessory</strong>为 <em>None</em>。<br><img src="http://upload-images.jianshu.io/upload_images/292794-59740ab79e37f7e6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>现在，用户在任何时候点击<strong>BasicCell</strong>都会跳转到<strong>DetailViewController</strong>里了。</p>
<p>哇塞，你的<strong>BasicCell</strong>已经设置完了！如果你编译运行 app 的话，还是毛都看不到，为啥呢…（<em>旁白</em>：自言自语..）<br><img src="http://upload-images.jianshu.io/upload_images/292794-93a32c53b29bfa42.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>还记得哪些<strong>TODO</strong>的注释吗？，对了，这就是问题所在了。你需要到哪些 TODOs 里写一些代码。</p>
<h2 id="配置-Table-View"><a href="#配置-Table-View" class="headerlink" title="配置 Table View"></a>配置 Table View</h2><p>首先，你需要配置下这个 table view。<br>打开<strong>FeedViewController.swift</strong>，用下面的代码替换<strong>configureTableView()</strong>这个方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">func configureTableView() &#123;</span><br><span class="line">  tableView.rowHeight = UITableViewAutomaticDimension</span><br><span class="line">  tableView.estimatedRowHeight = 160.0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>确信 table view 是用 auto layout 来动态设置高的时候，将<strong>rowHeight</strong>设置为<strong>UITableViewAutomaticDimension</strong>。<br>确定这些之后，你还要提供一个<strong>estimatedRowHeight</strong>的值。小意思，<strong>160.0</strong>是一个随意的值也可以使用。在你的项目里，你可能也想根据数据类型设置一个更好的值。</p>
<h2 id="实现-UITableView-的-Data-Source"><a href="#实现-UITableView-的-Data-Source" class="headerlink" title="实现 UITableView 的 Data Source"></a>实现 UITableView 的 Data Source</h2><p>接下来，你需要实现<strong>UITableViewDataSource</strong>的协议方法。<br>首先，在<strong>FeedViewController</strong>里加上这个常量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let basicCellIdentifier = &quot;BasicCell&quot;</span><br></pre></td></tr></table></figure>
<p>这可以让你用这个标识在 storyboard 里取得<strong>BasicCell</strong>。<br>接下来，用<strong>tableView(_:numberOfRowsInSection:)</strong>返回从 Deviant Art 获取到数据个数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func tableView(tableView: UITableView, numberOfRowsInSection section: Int) -&gt; Int &#123;</span><br><span class="line">  return items.count</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后用，下面的代码替换<strong>tableView(_:cellForRowAtIndexPath:)</strong>这个方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">func tableView(tableView: UITableView, cellForRowAtIndexPath indexPath: NSIndexPath) -&gt; UITableViewCell &#123;</span><br><span class="line">  return basicCellAtIndexPath(indexPath)</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">func basicCellAtIndexPath(indexPath:NSIndexPath) -&gt; BasicCell &#123;</span><br><span class="line">  let cell = tableView.dequeueReusableCellWithIdentifier(basicCellIdentifier) as! BasicCell</span><br><span class="line">  setTitleForCell(cell, indexPath: indexPath)</span><br><span class="line">  setSubtitleForCell(cell, indexPath: indexPath)</span><br><span class="line">  return cell</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">func setTitleForCell(cell:BasicCell, indexPath:NSIndexPath) &#123;</span><br><span class="line">  let item = items[indexPath.row] as RSSItem</span><br><span class="line">  cell.titleLabel.text = item.title ?? &quot;[No Title]&quot;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">func setSubtitleForCell(cell:BasicCell, indexPath:NSIndexPath) &#123;</span><br><span class="line">  let item = items[indexPath.row] as RSSItem</span><br><span class="line">  var subtitle: NSString? = item.mediaText ?? item.mediaDescription</span><br><span class="line"> </span><br><span class="line">  if let subtitle = subtitle &#123;</span><br><span class="line"> </span><br><span class="line">    // Some subtitles are really long, so only display the first 200 characters</span><br><span class="line">    if subtitle.length &gt; 200 &#123;</span><br><span class="line">      cell.subtitleLabel.text = &quot;\(subtitle.substringToIndex(200))...&quot;</span><br><span class="line"> </span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      cell.subtitleLabel.text = subtitle as String</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    cell.subtitleLabel.text = &quot;&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这边发生什么：</p>
<ul>
<li>在 tableView(<em>:cellForRowAtIndexPath:) 里，调用basicCellAtIndexPath(</em>:) 方法获取一个<strong>BasicCell</strong>。</li>
<li>在basicCellAtIndexPath(<em>:)里获取一个<strong>BasicCell</strong>，使用setTitleForCell(</em>:indexPath:) 方法设置 title label 的text，使用<strong> setSubtitleForCell(_:indexPath:)</strong>方法设置 subtitle label 的text，然后return 这个 cell。</li>
</ul>
<p>现在，你需要实现… 等等，搞定了！就这么简单？<br>编译运行，你将看到这个表格：<br><img src="http://upload-images.jianshu.io/upload_images/292794-d7702d171e6a9f76.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h2 id="图片在哪呢？"><a href="#图片在哪呢？" class="headerlink" title="图片在哪呢？"></a>图片在哪呢？</h2><p>这个app看起来还不错，但是好像感觉缺了点什么？<br>噢，艺术在哪呢？</p>
<p>Deviant Art 上都是图片，但这个 app 没有显示它们，你需要去修复下这个问题，不然，你的老大会让你失去理智！</p>
<p>有个方法是在你的<strong>BasicCell</strong>上加一个 image view。</p>
<p>但是在 Deviant Art 上带图片的信息和纯文字的信息都有，所以更好的做法是新建一个自定义 cell。</p>
<p>增加一个继承自<strong>BasicCell</strong>的新类到项目里，名字叫<strong>ImageCell</strong>，原因是你的新 cell 也需要<strong>titleLabel</strong>和<strong>subtitleLabel</strong>。因此，有必要在基类里已经存在一些方法的时候再做所有的事吗？</p>
<p>打开<strong>ImageCell.swift</strong>并且增加下面的属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@IBOutlet var customImageView: UIImageView!</span><br></pre></td></tr></table></figure>
<p>这个属性的名字是<strong>customImageView</strong>，因为在 UITableViewCell 里已经有了一个叫<strong>ImageView</strong>的属性了。</p>
<p>打开<strong>Main.storyboard</strong>，选择 basic cell 使用<strong>⌘C</strong>，或者从菜单里选择<strong>Edit &gt; Copy</strong>。</p>
<p>选择这个 table view 并且 按下<strong>⌘V</strong>，或者<strong>Edit &gt; Paste</strong>，去创建一个 cell 的新 copy 。</p>
<p><strong>注意</strong>：如果你操作有误，没有得到想要的结果，记得使用<strong>⌘Z</strong>或者<strong>Edit &gt; Undo</strong>来撤销操作。</p>
<p>选择新 cell ，更改它的<strong>Custom Class</strong>为<strong>ImageCell</strong>。同样的，更改它的<strong>Reuse Identifier</strong>为<strong>ImageCell</strong>。</p>
<p>在<strong>ImageCell</strong>上选择 title label，更改它的位置 x 为<strong>128</strong>，且宽度为<strong>172</strong>。subtitle label 也是一样。</p>
<p>Interface Builder 将会有一些警告，因为这些 labels 摆放的位置和约束设置的不一样。</p>
<p>正确的做法是，选择<strong>ImageCell</strong>上的 title label 删掉<strong>leading</strong>这条约束，subtitle label 也是一样删掉<strong>leading</strong>约束。</p>
<p>现在选择<strong>ImageCell</strong>的 title label，按照下面的截图改变它的<strong>Intrinsic Size</strong>的<em> Placeholder </em>的值。同样的，改变 subtitle label 的<strong>Intrinsic Size</strong>。<br>（这是用来告诉 Interface Builder 去更新当前 view 的 frame 的占位符，Interface Builder 将不会显示警告了。）<br><img src="http://upload-images.jianshu.io/upload_images/292794-2765e10b7f1cc464.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>你需要在 cell 上增加一个 image view。但是现在的高度有一点小，所以选择<strong>ImageCell</strong>修改它的<strong>Row Height</strong>为<strong>141</strong>。</p>
<p>现在，拖拽一个 image view 到<strong>ImageCell</strong>上，按照下面的截图设置这个新 view 的位置和尺寸。<br><img src="http://upload-images.jianshu.io/upload_images/292794-fc841c3a50ffae77.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>接下来，选择这个 image view 做如下布局：</p>
<ul>
<li>设置<strong>leading</strong>，<strong>top</strong>和<strong>bottom</strong>为<strong>20</strong>。</li>
<li>设置<strong>width</strong>和<strong>height</strong>为<strong>100</strong>。</li>
<li>确认<strong>Constrain to margins</strong>没有被勾选</li>
<li>最后点击<strong>Add 5 constrain</strong>的按钮。<br><img src="http://upload-images.jianshu.io/upload_images/292794-866636a6c8206be1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></li>
</ul>
<p>选择<strong>image view</strong>显示它的所有约束，然后选择它的<strong>bottom</strong>约束来编辑它。在属性编辑器里，改变<strong>Relation</strong>为<strong>Greater Than or Equal</strong>它的<strong>Priority</strong>为 <em>999</em>。<br><img src="http://upload-images.jianshu.io/upload_images/292794-c73f8d6e70fc375d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>同样的，选择 subtitle label 去显示它的所有约束条件，然后选择它的<strong>bottom</strong>，在属性编辑器里，改变<strong>Relation</strong>为<strong>Greater Than or Equal</strong>它的<strong>Priority</strong>为 <em>1000</em>。</p>
<p>这是告诉 auto layout 在<strong>imageView</strong>和<strong>subtitleLabel</strong>向下的约束都为20个点的时候，打破<strong>imageView</strong>的，遵循<strong>subtitleLabel</strong>的。（<em>旁白</em>：因为它的优先级高，这样避免约束冲突。）</p>
<p>然后将 image view 的<strong>height</strong>和<strong>width</strong>约束的优先级<strong>Priority</strong>设置成<strong>999</strong>。<br>这是因为自定义的约束有时候会和系统定义的约束之间会产生冲突，这时就是告诉 auto layout ，“如果一定要这么做，就打破这些自定义的约束吧”<br>（<em>旁白</em>：系统定义的优先级高，1000。）</p>
<p>在大部分情况下，auto layout 都会满足这些约束。在极少数的情况下它会打破这些约束，比如在改变设备方向时，但通常都是1-2的像素偏差，不明显。</p>
<p><strong>提示</strong>: 尤其在 table view cell上， auto layout 不总是很明显的提示这些约束。<br>如果你在控制台上看到这些 auto layout 不得不打破一个约束的警告信息，你就要试着去调整下你的约束条件的<strong>priorities</strong>了。</p>
<p>最后，选择<strong>ImageCell</strong>上的 title label 使用 Pin Button 来设置下<strong>leading</strong>约束为<strong>8</strong>。subtitle label 也是一样的。<br><img src="http://upload-images.jianshu.io/upload_images/292794-cb0cea31f71f636d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>现在你的<strong>ImageCell</strong>上的约束看起来是这个样子的：<br><img src="http://upload-images.jianshu.io/upload_images/292794-b4c2a9c6503a1bf7.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>你需要选择<strong>ImageCell</strong>和 image view 的<strong>customImageView</strong>outlet 进行链接。</p>
<p>你需要一个<strong>ImageCell</strong>跳转到<strong>Deviant Media</strong>场景的链接（segue），<br>这样用户点击<strong>ImageCell</strong>就可以看到详情了。</p>
<p>像之前设置 basic cell 一样， 选择<strong>ImageCell</strong>，按住 control 并拖拽到<strong>Deviant Media</strong>场景，然后在<strong>Selection Segue</strong>选项中选择<strong>Push</strong>。</p>
<p>确认你的<strong>Accessory</strong>改回为<strong>None</strong>。</p>
<p>非常好，你的<strong>ImageCell</strong>已经设置完成了！现在你可以加一些代码让它显示出来了。</p>
<h2 id="显示这些图片！"><a href="#显示这些图片！" class="headerlink" title="显示这些图片！"></a>显示这些图片！</h2><p>打开<strong>FeedViewController.swift</strong>在上面增加一个常量：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">let imageCellIdentifier = &quot;ImageCell&quot;</span><br></pre></td></tr></table></figure>
<p>接下来替换<strong>tableView(_:cellForRowAtIndexPath:)</strong>的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">func tableView(tableView: UITableView, cellForRowAtIndexPath indexPath: NSIndexPath) -&gt; UITableViewCell &#123;</span><br><span class="line">  if hasImageAtIndexPath(indexPath) &#123;</span><br><span class="line">    return imageCellAtIndexPath(indexPath)</span><br><span class="line"> </span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    return basicCellAtIndexPath(indexPath)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">func hasImageAtIndexPath(indexPath:NSIndexPath) -&gt; Bool &#123;</span><br><span class="line">  let item = items[indexPath.row]</span><br><span class="line">  let mediaThumbnailArray = item.mediaThumbnails as! [RSSMediaThumbnail]</span><br><span class="line"> </span><br><span class="line">  for mediaThumbnail in mediaThumbnailArray &#123;</span><br><span class="line">    if mediaThumbnail.url != nil &#123;</span><br><span class="line">      return true</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  return false</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">func imageCellAtIndexPath(indexPath:NSIndexPath) -&gt; ImageCell &#123;</span><br><span class="line">  let cell = self.tableView.dequeueReusableCellWithIdentifier(imageCellIdentifier) as! ImageCell</span><br><span class="line">  setImageForCell(cell, indexPath: indexPath)</span><br><span class="line">  setTitleForCell(cell, indexPath: indexPath)</span><br><span class="line">  setSubtitleForCell(cell, indexPath: indexPath)</span><br><span class="line">  return cell</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">func setImageForCell(cell:ImageCell, indexPath:NSIndexPath) &#123;</span><br><span class="line">  let item: RSSItem = items[indexPath.row]</span><br><span class="line"> </span><br><span class="line">  // mediaThumbnails are generally ordered by size,</span><br><span class="line">  // so get the second mediaThumbnail, which is a</span><br><span class="line">  // &quot;medium&quot; sized image</span><br><span class="line"> </span><br><span class="line">  var mediaThumbnail: RSSMediaThumbnail?</span><br><span class="line"> </span><br><span class="line">  if item.mediaThumbnails.count &gt;= 2 &#123;</span><br><span class="line">    mediaThumbnail = item.mediaThumbnails[1] as? RSSMediaThumbnail</span><br><span class="line"> </span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    mediaThumbnail = (item.mediaThumbnails as NSArray).firstObject as? RSSMediaThumbnail</span><br><span class="line">  &#125;</span><br><span class="line"> </span><br><span class="line">  cell.customImageView.image = nil</span><br><span class="line"> </span><br><span class="line">  if let url = mediaThumbnail?.url &#123;</span><br><span class="line">    cell.customImageView.setImageWithURL(url)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>像上面创建<strong>BasicCell</strong>一样，但是有一点不同，有一些新的代码：</p>
<ul>
<li><strong>hasImageAtIndexPath(_:)</strong>检查<strong>IndexPath</strong>下的item的<strong>mediaThumbnail</strong>的 url 不为空。如果不为空的要使用<strong>ImageCell</strong>来展示数据。</li>
<li><strong>imageCellAtIndexPath(_:)</strong>和<strong>basicCellAtIndexPath(_:)</strong>一样，但是它要用<em> </em>setImageForCell(_:indexPath:)**来设置下图片。</li>
<li><strong>setImageForCell(_:indexPath:)</strong>尝试获取第二个 media thumbnail。使用 <a href="http://afnetworking.com" target="_blank" rel="noopener">AFNetworking</a>提供的<strong>setImageWithURL(_:)</strong>方法来获取图片。</li>
</ul>
<p>编译运行，你将看到漂亮的艺术图片！默认，app 检索 “popular“ 分类的数据，但你也能按照艺术家搜索。</p>
<p>试着输入<strong>by:CheshireCatAr t</strong>并搜索。这是我的一个朋友，Devin Kraft,他是一个杰出的画家。（查看他的<a href="http://cheshirecatart.com" target="_blank" rel="noopener">website</a>）。</p>
<p>这是我很喜欢的一位，他在 Deviant Art 上很活跃，发过作品和博客。因此，他的账号是个很好的测试账号，可以测试带图片的 cell 和不带图片的 cell。<br><img src="http://upload-images.jianshu.io/upload_images/292794-d8bb318f8ad78ca6.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p>这个 app 已经看起来很漂亮了，但是你还可以让你的老大对你的技能信心提升一到两个级别。</p>
<h2 id="优化表格"><a href="#优化表格" class="headerlink" title="优化表格"></a>优化表格</h2><p>还记得很早之前设置<strong>estimatedRowHeight</strong>为<strong>160.0</strong>的时候吗？这个属性是在<strong>BasicCell</strong>的竖屏方向上工作的。但是这个值非常的不准。</p>
<p>你可以使用<strong>UITableViewDelegate</strong>提供的，在运行时给 cell 估算高度的方法替换这个值。</p>
<p>改之前，你需要删除<strong>configureTableView():</strong>里的一行代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableView.estimatedRowHeight = 160.0</span><br></pre></td></tr></table></figure>
<p>现在，在<strong>// MARK: UITextFieldDelegate</strong>组下增加下面的方法。（实际上，你可以在这个类的任何地方增加它们，但这样结构比较清楚易读。）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// MARK: UITableViewDelegate</span><br><span class="line"> </span><br><span class="line">func tableView(tableView: UITableView, estimatedHeightForRowAtIndexPath indexPath: NSIndexPath) -&gt; CGFloat &#123;</span><br><span class="line">  if isLandscapeOrientation() &#123;</span><br><span class="line">    return hasImageAtIndexPath(indexPath) ? 140.0 : 120.0</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    return hasImageAtIndexPath(indexPath) ? 235.0 : 155.0</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">func isLandscapeOrientation() -&gt; Bool &#123;</span><br><span class="line">  return UIInterfaceOrientationIsLandscape(UIApplication.sharedApplication().statusBarOrientation)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个预估 cell 高的方法很简单。检查当前方向是否是横屏并且如果当前 index path 有图片的话，返回一个预先裁定的值。</p>
<p><strong>提示</strong>：不论你是实现的代理方法，还是简单的设置了一个<strong>estimatedRowHeight</strong>固定的值。<br>这个 table view 会在代理方法和<strong>estimatedRowHeight</strong>的值之中选择一个。它会影响到滑动的指示条和滑动的性能。（是否卡顿）<br>如果你的 cell 预估的高度不太正确，那么在滑动的时候就会卡顿，滑动指示条不太准，内容也会混乱。<br>如果你的预估是准确的，计算就会慢，table view 滚动也会变慢。<br>这个成功的关键就在于在准确和不准确之间找一个平衡，减少不必要的计算成本。<br>（<em>旁白</em>：难道自己慢慢调试这个数值吗？）</p>
<p>你还是使用固定的值来估算的高度，但是现在可以根据 cell 的类型和设备的方向来设置更合理的高度了。你可以设置自己感兴趣的值，但是记住诀窍就是能让它计算的更快就行。</p>
<p>编译并运行，你应该能看到 table view 滑动的很流畅，看起来很棒。</p>
<p>这就是方法的最后实现，这个 app 现在完成了！<br><img src="http://upload-images.jianshu.io/upload_images/292794-5e6697a0e6d888be.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h2 id="从这去哪呢"><a href="#从这去哪呢" class="headerlink" title="从这去哪呢"></a>从这去哪呢</h2><p>你可以去下载完成项目，<a href="http://www.raywenderlich.com/wp-content/uploads/2015/01/DeviantArtBrowser_Final.zip" target="_blank" rel="noopener">在这</a><br>（<em>旁白</em>:上面的路径下载下来的项目编译会报错，因为它是用Xcode6.3和Swift1.2做的，转换到最新语法之后，在像上面已经提到过的修改一个方法的代码，添加http白名单。<a href="https://github.com/al-liu/RayWenderlich-Demos">你也可以下载这里已经修改过的代码</a>）</p>
<p>Table views 可能是iOS里面组织数据视图中最常用的了。你的 apps 会很复杂，你可能要使用各种类型的自定义 cell 来布局。幸运的是 iOS8 和 auto layout 能很容易的做到这些。<br>（<em>旁白</em>：不幸的是，有多少 app 是只支持iOS8以上的呢。）</p>
<p>如果你有一些问题或建议，请在下面留言。</p>

  </div>
</article>



    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
    <script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>
    <div id="gitalk-container"></div>
    <script type="text/javascript">
        var gitalk = new Gitalk({
            clientID: '46f9862d762f2b91e265',
            clientSecret: 'b1a5c3d47828b1c1ab0b25081463e2b94f132245',
            id: md5(window.location.pathname),
            repo: 'al-liu.github.io',
            owner: 'al-liu',
            admin: 'al-liu',
            distractionFreeMode: ''
        })
        gitalk.render('gitalk-container')
    </script>




        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="https://github.com/al-liu">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="https://github.com/al-liu?tab=repositories">项目</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#让我们开始"><span class="toc-number">1.</span> <span class="toc-text">让我们开始</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#教程-App-概览"><span class="toc-number">2.</span> <span class="toc-text">教程 App 概览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#开始创建自定义-Cell"><span class="toc-number">3.</span> <span class="toc-text">开始创建自定义 Cell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置-Table-View"><span class="toc-number">4.</span> <span class="toc-text">配置 Table View</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实现-UITableView-的-Data-Source"><span class="toc-number">5.</span> <span class="toc-text">实现 UITableView 的 Data Source</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#图片在哪呢？"><span class="toc-number">6.</span> <span class="toc-text">图片在哪呢？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#显示这些图片！"><span class="toc-number">7.</span> <span class="toc-text">显示这些图片！</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#优化表格"><span class="toc-number">8.</span> <span class="toc-text">优化表格</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#从这去哪呢"><span class="toc-number">9.</span> <span class="toc-text">从这去哪呢</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/&text=UITableView 教程：动态 Table View Cell 高"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/&title=UITableView 教程：动态 Table View Cell 高"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/&is_video=false&description=UITableView 教程：动态 Table View Cell 高"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=UITableView 教程：动态 Table View Cell 高&body=Check out this article: https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/&title=UITableView 教程：动态 Table View Cell 高"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/&title=UITableView 教程：动态 Table View Cell 高"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/&title=UITableView 教程：动态 Table View Cell 高"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/&title=UITableView 教程：动态 Table View Cell 高"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://github.com/al-liu/2019/03/29/UITableView-教程：动态-Table-View-Cell-高/&name=UITableView 教程：动态 Table View Cell 高&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 刘海川 al-liu
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="https://github.com/al-liu">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="https://github.com/al-liu?tab=repositories">项目</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
